<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sammanfattning Kapitel 3 - Esthers Matte</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Verdana, Geneva, sans-serif;
            font-size: 16px;
            line-height: 1.6;
            background: linear-gradient(135deg, #fdf6f9 0%, #f0f4f8 100%);
            min-height: 100vh;
            color: #4a4a4a;
        }

        :root {
            --pastel-pink: #f8e1e8;
            --pastel-blue: #e1ecf8;
            --pastel-green: #e1f8e8;
            --pastel-yellow: #f8f4e1;
            --pastel-purple: #efe1f8;
            --text-dark: #4a4a4a;
            --text-medium: #6a6a6a;
            --accent-pink: #d4a5b5;
            --accent-blue: #a5c4d4;
            --success-green: #98d4a5;
            --warning-orange: #ffb74d;
            --white: #ffffff;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 30px 40px;
        }

        /* === HEADER === */
        .header {
            background: var(--white);
            border-radius: 20px;
            padding: 30px 35px;
            margin-bottom: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left h1 {
            font-size: 24px;
            color: var(--text-dark);
            margin-bottom: 5px;
        }

        .header-left p {
            font-size: 14px;
            color: var(--text-medium);
        }

        .header-right {
            display: flex;
            gap: 15px;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 25px;
            font-family: Verdana;
            font-size: 14px;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.2s;
            border: none;
        }

        .btn-primary {
            background: var(--accent-pink);
            color: white;
        }

        .btn-primary:hover {
            background: #c495a5;
        }

        .btn-secondary {
            background: var(--pastel-blue);
            color: var(--text-dark);
        }

        .btn-secondary:hover {
            background: #d4e4f4;
        }

        .btn-danger {
            background: #e8a5a5;
            color: white;
        }

        .btn-danger:hover {
            background: #d89595;
        }

        /* === √ñVERSIKTSKORT === */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: var(--white);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }

        .stat-card.green { border-top: 4px solid var(--success-green); }
        .stat-card.red { border-top: 4px solid #e8a5a5; }
        .stat-card.blue { border-top: 4px solid var(--accent-blue); }
        .stat-card.orange { border-top: 4px solid var(--warning-orange); }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 13px;
            color: var(--text-medium);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-sub {
            font-size: 12px;
            color: var(--text-medium);
            margin-top: 5px;
        }

        /* === TIDSSTATISTIK === */
        .time-stats {
            background: var(--white);
            border-radius: 20px;
            padding: 25px 30px;
            margin-bottom: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }

        .section-title {
            font-size: 18px;
            color: var(--text-dark);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--pastel-pink);
        }

        .time-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .time-box {
            background: var(--pastel-blue);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .time-box.min { background: var(--pastel-green); }
        .time-box.avg { background: var(--pastel-yellow); }
        .time-box.max { background: var(--pastel-pink); }

        .time-value {
            font-size: 28px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .time-label {
            font-size: 13px;
            color: var(--text-medium);
            margin-top: 5px;
        }

        /* === TABELL === */
        .table-container {
            background: var(--white);
            border-radius: 20px;
            padding: 25px 30px;
            margin-bottom: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        th {
            background: var(--pastel-blue);
            color: var(--text-dark);
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        th:first-child { border-radius: 10px 0 0 0; }
        th:last-child { border-radius: 0 10px 0 0; }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }

        tr:hover td {
            background: #fafafa;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-completed {
            background: var(--pastel-green);
            color: #4a7a5a;
        }

        .status-skipped {
            background: #fff3e0;
            color: #e65100;
        }

        .status-pending {
            background: #f5f5f5;
            color: #999;
        }

        .hint-count {
            display: inline-block;
            background: var(--pastel-purple);
            color: #6a5a7a;
            padding: 2px 8px;
            border-radius: 8px;
            font-size: 12px;
        }

        .attempts-count {
            font-weight: 600;
        }

        .attempts-1 { color: var(--success-green); }
        .attempts-2 { color: var(--warning-orange); }
        .attempts-3 { color: #e8a5a5; }

        /* === INGEN DATA === */
        .no-data {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-medium);
        }

        .no-data-icon {
            font-size: 60px;
            margin-bottom: 20px;
        }

        .no-data h2 {
            font-size: 20px;
            color: var(--text-dark);
            margin-bottom: 10px;
        }

        /* === FOOTER === */
        .footer {
            text-align: center;
            padding: 20px;
            color: var(--text-medium);
            font-size: 13px;
        }

        /* === RESPONSIV === */
        @media (max-width: 800px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .time-grid {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
        }

        /* === PRINT === */
        @media print {
            body { background: white; }
            .btn { display: none; }
            .container { max-width: 100%; padding: 20px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <header class="header">
            <div class="header-left">
                <h1>Kapitel 3 - Sammanfattning f√∂r Esther</h1>
                <p id="last-updated">Senast uppdaterad: -</p>
            </div>
            <div class="header-right">
                <a href="index.html" class="btn btn-secondary">‚Üê Tillbaka</a>
                <button class="btn btn-primary" onclick="exportCSV()">Exportera CSV</button>
                <button class="btn btn-danger" onclick="clearHistory()">üóëÔ∏è Rensa historik</button>
            </div>
        </header>

        <!-- √ñVERSIKT -->
        <div class="stats-grid">
            <div class="stat-card green">
                <div class="stat-value" id="completed-count">0</div>
                <div class="stat-label">R√§tta svar</div>
                <div class="stat-sub" id="completed-percent">0%</div>
            </div>
            <div class="stat-card red">
                <div class="stat-value" id="wrong-count">0</div>
                <div class="stat-label">Fel/√ñverhoppade</div>
                <div class="stat-sub" id="wrong-percent">0%</div>
            </div>
            <div class="stat-card blue">
                <div class="stat-value" id="total-time">0:00</div>
                <div class="stat-label">Total tid</div>
                <div class="stat-sub">p√• uppgifter</div>
            </div>
            <div class="stat-card orange">
                <div class="stat-value" id="hints-total">0</div>
                <div class="stat-label">Ledtr√•dar</div>
                <div class="stat-sub">anv√§nda totalt</div>
            </div>
        </div>

        <!-- TIDSSTATISTIK -->
        <div class="time-stats">
            <h2 class="section-title">Tid per sida</h2>
            <div class="time-grid">
                <div class="time-box min">
                    <div class="time-value" id="time-min">-</div>
                    <div class="time-label">Snabbaste sidan</div>
                </div>
                <div class="time-box avg">
                    <div class="time-value" id="time-avg">-</div>
                    <div class="time-label">Genomsnitt</div>
                </div>
                <div class="time-box max">
                    <div class="time-value" id="time-max">-</div>
                    <div class="time-label">L√§ngsta sidan</div>
                </div>
            </div>
        </div>

        <!-- RESULTAT PER SIDA -->
        <div class="table-container">
            <h2 class="section-title">Resultat per sida</h2>
            <div id="table-content">
                <div class="no-data">
                    <div class="no-data-icon">üìä</div>
                    <h2>Ingen data √§nnu</h2>
                    <p>B√∂rja med uppgifterna s√• visas statistiken h√§r!</p>
                </div>
            </div>
        </div>

        <footer class="footer">
            Skapad f√∂r Esthers matematiktr√§ning - Kapitel 3
        </footer>
    </div>

    <script>
        const STORAGE_PREFIX = 'esther-kap3';

        // Uppgiftsnamn f√∂r b√§ttre l√§sbarhet
        const taskNames = {
            1: 'Vad √§r ett koordinatsystem?',
            2: 'L√§sa av koordinater',
            3: 'Vad √§r proportionalitet?',
            4: 'Proportionella samband',
            5: 'K√§nna igen proportionalitet',
            6: 'Kombinera kl√§der',
            7: 'Tr√§ddiagram',
            8: 'R√§kna kombinationer',
            9: 'Bilda tal',
            10: 'Kombinatorik-problem',
            11: 'Prioriteringsregler',
            12: 'Multiplikation f√∂rst',
            13: 'Parenteser f√∂rst',
            14: 'Teckna uttryck',
            15: 'R√§kna ut uttryck',
            16: 'Vad √§r en variabel?',
            17: 'Teckna med x',
            18: 'Ber√§kna v√§rde',
            19: 'F√∂renkla uttryck',
            20: 'Flera variabler',
            21: 'Geometriska m√∂nster',
            22: 'Talf√∂ljder',
            23: 'Hitta m√∂nstret',
            24: 'Uttryck f√∂r m√∂nster',
            25: 'R√§kna med m√∂nster',
            26: 'Vad √§r en ekvation?',
            27: 'Balansmetoden',
            28: 'L√∂s enkel ekvation',
            29: 'Pr√∂vning',
            30: 'Ekvation-problem',
            31: 'Proportionalitet-problem',
            32: 'Kombinatorik-problem',
            33: 'Uttryck-problem',
            34: 'M√∂nster-problem',
            35: 'Ekvation-problem',
            36: 'Repetition: Proportionalitet',
            37: 'Repetition: Uttryck',
            38: 'Repetition: Ekvationer',
            39: 'Slutuppgift',
            40: 'GRATTIS!'
        };

        // H√§mta data fr√•n localStorage
        function getData() {
            const tracking = JSON.parse(localStorage.getItem(STORAGE_PREFIX + '-tracking') || '[]');
            const completed = JSON.parse(localStorage.getItem(STORAGE_PREFIX + '-completed-tasks') || '[]');
            const skipped = JSON.parse(localStorage.getItem(STORAGE_PREFIX + '-skipped-tasks') || '[]');
            return { tracking, completed, skipped };
        }

        // Formatera tid (ms till mm:ss)
        function formatTime(ms) {
            if (!ms || ms <= 0) return '-';
            const seconds = Math.floor(ms / 1000);
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            if (minutes > 0) {
                return `${minutes}:${secs.toString().padStart(2, '0')}`;
            }
            return `${secs}s`;
        }

        // Formatera total tid
        function formatTotalTime(ms) {
            if (!ms || ms <= 0) return '0:00';
            const seconds = Math.floor(ms / 1000);
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${minutes}:${secs.toString().padStart(2, '0')}`;
        }

        // Uppdatera statistik
        function updateStats() {
            const { tracking, completed, skipped } = getData();
            const total = 40;

            // √ñversiktssiffror
            const completedCount = completed.length;
            const skippedCount = skipped.filter(s => !completed.includes(s)).length;
            const wrongCount = skippedCount;

            document.getElementById('completed-count').textContent = completedCount;
            document.getElementById('completed-percent').textContent = Math.round((completedCount / total) * 100) + '%';
            document.getElementById('wrong-count').textContent = wrongCount;
            document.getElementById('wrong-percent').textContent = Math.round((wrongCount / total) * 100) + '%';

            // Ber√§kna tid och ledtr√•dar
            let totalTime = 0;
            let totalHints = 0;
            const times = [];

            tracking.forEach(t => {
                if (t.timeOnPage && t.timeOnPage > 0) {
                    totalTime += t.timeOnPage;
                    times.push(t.timeOnPage);
                }
                if (t.hintsUsed) {
                    totalHints += t.hintsUsed;
                }
            });

            document.getElementById('total-time').textContent = formatTotalTime(totalTime);
            document.getElementById('hints-total').textContent = totalHints;

            // Tidsstatistik
            if (times.length > 0) {
                const minTime = Math.min(...times);
                const maxTime = Math.max(...times);
                const avgTime = times.reduce((a, b) => a + b, 0) / times.length;

                document.getElementById('time-min').textContent = formatTime(minTime);
                document.getElementById('time-avg').textContent = formatTime(avgTime);
                document.getElementById('time-max').textContent = formatTime(maxTime);
            }

            // Senast uppdaterad
            document.getElementById('last-updated').textContent =
                'Senast uppdaterad: ' + new Date().toLocaleString('sv-SE');

            // Skapa tabell
            renderTable(tracking, completed, skipped);
        }

        // Rendera tabell
        function renderTable(tracking, completed, skipped) {
            const container = document.getElementById('table-content');

            if (tracking.length === 0 && completed.length === 0) {
                container.innerHTML = `
                    <div class="no-data">
                        <div class="no-data-icon">üìä</div>
                        <h2>Ingen data √§nnu</h2>
                        <p>B√∂rja med uppgifterna s√• visas statistiken h√§r!</p>
                    </div>
                `;
                return;
            }

            // Skapa map f√∂r snabb lookup
            const trackingMap = {};
            tracking.forEach(t => {
                trackingMap[t.task] = t;
            });

            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Uppgift</th>
                            <th>Status</th>
                            <th>Tid</th>
                            <th>F√∂rs√∂k</th>
                            <th>Ledtr√•dar</th>
                            <th>√Öterbes√∂k</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            for (let i = 1; i <= 40; i++) {
                const t = trackingMap[i] || {};
                const isCompleted = completed.includes(i);
                const isSkipped = skipped.includes(i) && !isCompleted;
                const hasData = t.task !== undefined;

                let status, statusClass;
                if (isCompleted) {
                    status = 'Klar';
                    statusClass = 'status-completed';
                } else if (isSkipped) {
                    status = '√ñverhoppad';
                    statusClass = 'status-skipped';
                } else {
                    status = 'Ej p√•b√∂rjad';
                    statusClass = 'status-pending';
                }

                const time = hasData ? formatTime(t.timeOnPage) : '-';
                const attempts = hasData && t.attempts ? t.attempts : '-';
                const attemptsClass = attempts === 1 ? 'attempts-1' :
                                      attempts === 2 ? 'attempts-2' :
                                      attempts >= 3 ? 'attempts-3' : '';
                const hints = hasData && t.hintsUsed ? t.hintsUsed : '0';
                const revisit = hasData && t.wasRevisit ? 'Ja' : '-';

                html += `
                    <tr>
                        <td>${i}</td>
                        <td>${taskNames[i] || 'Uppgift ' + i}</td>
                        <td><span class="status-badge ${statusClass}">${status}</span></td>
                        <td>${time}</td>
                        <td class="attempts-count ${attemptsClass}">${attempts}</td>
                        <td><span class="hint-count">${hints}</span></td>
                        <td>${revisit}</td>
                    </tr>
                `;
            }

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // Exportera CSV
        function exportCSV() {
            const { tracking, completed, skipped } = getData();
            const trackingMap = {};
            tracking.forEach(t => { trackingMap[t.task] = t; });

            let csv = 'Uppgift;Namn;Status;Tid (sek);F√∂rs√∂k;Ledtr√•dar;√Öterbes√∂k;Svar;Ledtr√•dstider\n';

            for (let i = 1; i <= 40; i++) {
                const t = trackingMap[i] || {};
                const isCompleted = completed.includes(i);
                const isSkipped = skipped.includes(i) && !isCompleted;

                const status = isCompleted ? 'Klar' : isSkipped ? '√ñverhoppad' : 'Ej p√•b√∂rjad';
                const timeSec = t.timeOnPage ? Math.round(t.timeOnPage / 1000) : '';
                const attempts = t.attempts || '';
                const hints = t.hintsUsed || '0';
                const revisit = t.wasRevisit ? 'Ja' : 'Nej';
                const answers = t.answers ? JSON.stringify(t.answers).replace(/;/g, ',') : '';
                const hintTimes = t.hintTimes ? t.hintTimes.map(h => Math.round(h/1000)).join(',') : '';

                csv += `${i};${taskNames[i] || 'Uppgift ' + i};${status};${timeSec};${attempts};${hints};${revisit};${answers};${hintTimes}\n`;
            }

            // Skapa och ladda ner fil
            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'esther-kap3-resultat-' + new Date().toISOString().slice(0,10) + '.csv';
            link.click();
        }

        // Rensa historik
        function clearHistory() {
            if (confirm('√Ñr du s√§ker? Detta raderar all sparad data f√∂r Kapitel 3.')) {
                localStorage.removeItem(STORAGE_PREFIX + '-tracking');
                localStorage.removeItem(STORAGE_PREFIX + '-completed-tasks');
                localStorage.removeItem(STORAGE_PREFIX + '-skipped-tasks');
                alert('Historiken har rensats!');
                location.reload();
            }
        }

        // K√∂r vid sidladdning
        updateStats();

        // Uppdatera var 5:e sekund om sidan √§r √∂ppen
        setInterval(updateStats, 5000);
    </script>
</body>
</html>
