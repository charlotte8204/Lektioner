<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uppgift 5: K√§nna igen proportionalitet - Esthers Matte</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Verdana, Geneva, sans-serif;
            font-size: 18px;
            line-height: 1.7;
            background: linear-gradient(135deg, #fdf6f9 0%, #f0f4f8 100%);
            min-height: 100vh;
            color: #4a4a4a;
        }

        :root {
            --pastel-pink: #f8e1e8;
            --pastel-blue: #e1ecf8;
            --pastel-green: #e1f8e8;
            --pastel-yellow: #f8f4e1;
            --text-dark: #4a4a4a;
            --text-medium: #6a6a6a;
            --accent-pink: #d4a5b5;
            --success-green: #98d4a5;
            --white: #ffffff;
        }

        .page-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 220px;
            background: var(--white);
            padding: 25px 20px;
            border-right: 1px solid #eee;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .sidebar-title {
            font-size: 14px;
            color: var(--text-medium);
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .nav-list {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 8px;
        }

        .nav-link {
            display: block;
            padding: 10px 12px;
            text-decoration: none;
            color: var(--text-medium);
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s;
        }

        .nav-link:hover {
            background: var(--pastel-blue);
        }

        .nav-link.current {
            background: var(--pastel-pink);
            color: var(--text-dark);
            font-weight: 600;
        }

        .nav-link.completed::before {
            content: "‚úì ";
            color: var(--success-green);
        }

        .you-are-here {
            font-size: 12px;
            color: var(--accent-pink);
            margin-left: 5px;
        }

        .main-content {
            flex: 1;
            margin-left: 220px;
            padding: 30px 50px;
            max-width: 800px;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .back-link {
            color: var(--accent-pink);
            text-decoration: none;
            font-size: 15px;
        }

        .progress-mini {
            font-size: 14px;
            color: var(--text-medium);
            background: var(--pastel-blue);
            padding: 8px 15px;
            border-radius: 20px;
        }

        .content-card {
            background: var(--white);
            border-radius: 20px;
            padding: 35px 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }

        .page-title {
            font-size: 24px;
            color: var(--text-dark);
            margin-bottom: 8px;
        }

        .page-subtitle {
            font-size: 15px;
            color: var(--text-medium);
            margin-bottom: 25px;
        }

        .start-indicator {
            display: inline-block;
            background: var(--pastel-green);
            color: #5a9a6a;
            padding: 8px 18px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .explanation {
            background: var(--pastel-yellow);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .explanation-text {
            font-size: 18px;
            line-height: 1.8;
        }

        .highlight-concept {
            background: #f0e8c8;
            padding: 2px 8px;
            border-radius: 5px;
            font-weight: 600;
        }

        .graph-container {
            display: flex;
            gap: 25px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 25px 0;
        }

        .graph-box {
            background: var(--pastel-blue);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }

        .graph-label {
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .graph-svg {
            background: white;
            border-radius: 10px;
        }

        .encouragement {
            text-align: center;
            font-size: 16px;
            color: var(--text-medium);
            font-style: italic;
            margin: 20px 0;
        }

        .task-section {
            background: var(--pastel-pink);
            border-radius: 15px;
            padding: 25px;
            margin-top: 25px;
        }

        .task-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 15px;
        }

        .task-instruction {
            font-size: 16px;
            color: var(--text-medium);
            margin-bottom: 20px;
        }

        .task-question {
            font-size: 18px;
            color: var(--text-dark);
            margin-bottom: 20px;
        }

        .answer-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .answer-btn {
            background: var(--white);
            border: 3px solid #ddd;
            padding: 15px 20px;
            border-radius: 12px;
            font-family: Verdana;
            font-size: 16px;
            color: var(--text-dark);
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }

        .answer-btn:hover {
            border-color: var(--accent-pink);
            transform: translateX(5px);
        }

        .answer-btn.correct {
            border-color: var(--success-green);
            background: #e8f8eb;
        }

        .answer-btn.incorrect {
            border-color: #e8a5a5;
            background: #f8e8e8;
        }

        .answer-btn:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .feedback {
            margin-top: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            display: none;
        }

        .feedback.show {
            display: block;
        }

        .feedback.correct {
            background: var(--pastel-green);
            color: #4a7a5a;
        }

        .feedback.incorrect {
            background: #f8e8e8;
            color: #7a4a4a;
        }

        .success-section {
            display: none;
            text-align: center;
            margin-top: 25px;
            padding: 25px;
            background: var(--pastel-green);
            border-radius: 15px;
        }

        .success-section.show {
            display: block;
        }

        .success-message {
            font-size: 20px;
            color: #4a7a5a;
            margin-bottom: 20px;
        }

        .next-btn {
            background: var(--success-green);
            color: white;
            border: none;
            padding: 15px 35px;
            border-radius: 30px;
            font-family: Verdana;
            font-size: 18px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }

        .next-btn:hover {
            background: #88c498;
        }

        .pause-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--pastel-green);
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            font-family: Verdana;
            font-size: 14px;
            color: var(--text-dark);
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .hint-button {
            background: #b8a5d4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-family: Verdana;
            font-size: 14px;
            cursor: pointer;
            margin-top: 15px;
        }

        .hint-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .hint-section {
            background: linear-gradient(135deg, #efe1f8 0%, #e8d4f4 100%);
            border-radius: 15px;
            padding: 20px 25px;
            margin-top: 20px;
            border-left: 4px solid #b8a5d4;
            display: none;
        }

        .hint-section.show {
            display: block;
        }

        .hint-step {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 3px solid #b8a5d4;
            display: none;
        }

        .hint-step.show {
            display: block;
        }

        .hint-step-number {
            font-size: 12px;
            color: #9a8aaa;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .hint-step-text {
            font-size: 16px;
            color: var(--text-dark);
        }

        .hint-progress {
            display: flex;
            gap: 8px;
            margin-top: 15px;
        }

        .hint-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #d4c5e4;
        }

        .hint-dot.active {
            background: #b8a5d4;
        }

        .skip-section {
            margin-top: 20px;
            text-align: center;
        }

        .skip-btn {
            background: transparent;
            border: 2px solid #ddd;
            color: var(--text-medium);
            padding: 10px 20px;
            border-radius: 20px;
            font-family: Verdana;
            font-size: 14px;
            cursor: pointer;
        }

        .skip-btn:hover {
            border-color: #ffb74d;
            color: #e65100;
        }

        .pause-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .pause-modal.active {
            display: flex;
        }

        .pause-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
        }

        .pause-content h2 {
            margin-bottom: 15px;
        }

        .pause-content p {
            margin-bottom: 25px;
            color: var(--text-medium);
        }

        .pause-close {
            background: var(--accent-pink);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-family: Verdana;
            font-size: 16px;
            cursor: pointer;
        }

        /* === STICKY TIPS SIDEBAR === */
        .tips-sidebar {
            margin-top: auto;
            padding-top: 20px;
        }

        .tips-sticky-note {
            background: #fffacd;
            border-radius: 5px;
            padding: 18px 15px;
            box-shadow:
                3px 3px 10px rgba(0,0,0,0.1),
                0 0 0 1px rgba(0,0,0,0.05);
            transform: rotate(-2deg);
            position: relative;
        }

        .tips-sticky-note::before {
            content: "";
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 15px;
            background: rgba(200, 180, 140, 0.6);
            border-radius: 2px;
        }

        .tips-sticky-title {
            font-size: 13px;
            font-weight: 600;
            color: #7a6a4a;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .tips-sticky-list {
            list-style: none;
            font-size: 12px;
            color: #6a5a3a;
            line-height: 1.5;
        }

        .tips-sticky-list li {
            padding: 4px 0;
            padding-left: 18px;
            position: relative;
        }

        .tips-sticky-list li::before {
            content: "üí°";
            position: absolute;
            left: 0;
            font-size: 10px;
        }

        .nav-list {
            flex-shrink: 0;
        }
    </style>
</head>
<body>
    <!-- Kommentar f√∂r f√∂r√§lder/pedagog:
         Uppgift 5: Eleven ska k√§nna igen proportionalitet genom att
         titta p√• grafer. En proportionell graf g√•r genom origo (0,0).
    -->

    <div class="page-container">
        <nav class="sidebar">
            <div class="sidebar-title">Inneh√•ll</div>
            <ul class="nav-list">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">‚Üê Tillbaka</a>
                </li>
                <li class="nav-item">
                    <a href="uppgift-03-vad-ar-proportionalitet.html" class="nav-link" id="nav-3">3. Proportionalitet</a>
                </li>
                <li class="nav-item">
                    <a href="uppgift-04-proportionella-samband.html" class="nav-link" id="nav-4">4. Proportionella samband</a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link current">
                        5. K√§nna igen grafer
                        <span class="you-are-here">‚Üê Du √§r h√§r</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="uppgift-06-kombinera-klader.html" class="nav-link" id="nav-6">6. Kombinera kl√§der</a>
                </li>
            </ul>
            <!-- STICKY TIPS -->
            <aside class="tips-sidebar">
                <div class="tips-sticky-note">
                    <div class="tips-sticky-title">üìù Tips till Esther</div>
                    <ul class="tips-sticky-list">
                        <li>Ha papper och penna bredvid dig</li>
                        <li>L√§s instruktionerna klart f√∂rst</li>
                        <li>Ta paus var 20:e minut</li>
                        <li>Det √§r okej att g√∂ra fel!</li>
                    </ul>
                </div>
            </aside>
        </nav>

        <main class="main-content">
            <div class="top-bar">
                <a href="index.html" class="back-link">‚Üê Alla uppgifter</a>
                <span class="progress-mini">Uppgift 5 av 40</span>
            </div>

            <div class="content-card">
                <h1 class="page-title">K√§nna igen proportionalitet</h1>
                <p class="page-subtitle">Vilken graf visar ett proportionellt samband?</p>

                <div class="start-indicator">‚ñ∂ B√ñRJA H√ÑR</div>

                <div class="explanation">
                    <p class="explanation-text">
                        En <span class="highlight-concept">proportionell graf</span> har tv√• k√§nnetecken:
                        <br><br>
                        1. Den √§r en <strong>rak linje</strong>
                        <br>
                        2. Den g√•r genom <strong>origo (0, 0)</strong> - d√§r axlarna m√∂ts!
                    </p>
                </div>

                <div class="graph-container">
                    <div class="graph-box">
                        <div class="graph-label">Graf A</div>
                        <svg class="graph-svg" width="140" height="140" viewBox="0 0 140 140">
                            <line x1="20" y1="120" x2="130" y2="120" stroke="#ccc" stroke-width="2"/>
                            <line x1="20" y1="120" x2="20" y2="10" stroke="#ccc" stroke-width="2"/>
                            <circle cx="20" cy="120" r="4" fill="#d4a5b5"/>
                            <text x="15" y="135" font-size="10" fill="#6a6a6a">0</text>
                            <!-- Rak linje genom origo -->
                            <line x1="20" y1="120" x2="120" y2="20" stroke="#d4a5b5" stroke-width="3"/>
                        </svg>
                    </div>
                    <div class="graph-box">
                        <div class="graph-label">Graf B</div>
                        <svg class="graph-svg" width="140" height="140" viewBox="0 0 140 140">
                            <line x1="20" y1="120" x2="130" y2="120" stroke="#ccc" stroke-width="2"/>
                            <line x1="20" y1="120" x2="20" y2="10" stroke="#ccc" stroke-width="2"/>
                            <circle cx="20" cy="120" r="4" fill="#d4a5b5"/>
                            <text x="15" y="135" font-size="10" fill="#6a6a6a">0</text>
                            <!-- Kurva -->
                            <path d="M 20 120 Q 70 110 90 60 Q 110 20 120 20" stroke="#d4a5b5" stroke-width="3" fill="none"/>
                        </svg>
                    </div>
                    <div class="graph-box">
                        <div class="graph-label">Graf C</div>
                        <svg class="graph-svg" width="140" height="140" viewBox="0 0 140 140">
                            <line x1="20" y1="120" x2="130" y2="120" stroke="#ccc" stroke-width="2"/>
                            <line x1="20" y1="120" x2="20" y2="10" stroke="#ccc" stroke-width="2"/>
                            <circle cx="20" cy="120" r="4" fill="#d4a5b5"/>
                            <text x="15" y="135" font-size="10" fill="#6a6a6a">0</text>
                            <!-- Rak linje men b√∂rjar inte i origo -->
                            <line x1="20" y1="90" x2="120" y2="30" stroke="#d4a5b5" stroke-width="3"/>
                        </svg>
                    </div>
                </div>

                <p class="encouragement">
                    Titta noga p√• graferna ovan!
                </p>

                <div class="task-section">
                    <h2 class="task-title">‚úèÔ∏è Prova sj√§lv!</h2>
                    <p class="task-instruction">
                        Klicka p√• r√§tt svar.
                    </p>

                    <p class="task-question">
                        Vilken graf visar ett <strong>proportionellt samband</strong>?
                    </p>

                    <div class="answer-options">
                        <button class="answer-btn" onclick="checkAnswer(this, true)" data-answer="A">
                            A) Graf A - rak linje genom origo
                        </button>
                        <button class="answer-btn" onclick="checkAnswer(this, false)" data-answer="B">
                            B) Graf B - kurva
                        </button>
                        <button class="answer-btn" onclick="checkAnswer(this, false)" data-answer="C">
                            C) Graf C - rak linje men startar inte i origo
                        </button>
                    </div>

                    <div class="feedback" id="feedback"></div>

                    <button class="hint-button" onclick="showNextHint()">
                        üí° Jag beh√∂ver en ledtr√•d
                    </button>

                    <div class="hint-section" id="hint-section">
                        <p style="font-style: italic; color: #7a6a8a; margin-bottom: 15px;">Bra att du fr√•gar!</p>

                        <div class="hint-step" id="hint-1">
                            <div class="hint-step-number">STEG 1</div>
                            <p class="hint-step-text">
                                En proportionell graf m√•ste vara <strong>rak</strong> (ingen kurva).
                            </p>
                        </div>

                        <div class="hint-step" id="hint-2">
                            <div class="hint-step-number">STEG 2</div>
                            <p class="hint-step-text">
                                Den m√•ste ocks√• g√• genom <strong>origo (0, 0)</strong> - d√§r axlarna m√∂ts.
                            </p>
                        </div>

                        <div class="hint-step" id="hint-3">
                            <div class="hint-step-number">STEG 3</div>
                            <p class="hint-step-text">
                                Vilken graf uppfyller B√ÖDA kraven: rak linje OCH g√•r genom origo?
                            </p>
                        </div>

                        <div class="hint-progress">
                            <span class="hint-dot" id="dot-1"></span>
                            <span class="hint-dot" id="dot-2"></span>
                            <span class="hint-dot" id="dot-3"></span>
                        </div>
                    </div>

                    <div class="skip-section">
                        <button class="skip-btn" onclick="skipTask()">Hoppa √∂ver ‚Üí</button>
                    </div>
                </div>

                <div class="success-section" id="success">
                    <p class="success-message">üéâ Helt r√§tt! Graf A √§r proportionell - rak linje genom origo!</p>

                    <!-- UTMANING -->
                    <div class="challenge-section" style="margin-top: 25px; background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%); border-radius: 15px; padding: 20px; border-left: 4px solid #ffc107; text-align: left;">
                        <button onclick="toggleChallenge()" style="background: #ffc107; color: #5d4037; border: none; padding: 10px 20px; border-radius: 20px; font-family: Verdana; font-size: 14px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                            üåü Utmaning <span id="challenge-arrow">‚ñº</span>
                        </button>
                        <div id="challenge-content" style="display: none; margin-top: 15px;">
                            <p style="font-size: 16px; color: #5d4037; margin-bottom: 15px;">
                                <strong>Sv√•rare uppgift:</strong> En graf visar att 2 kg √§pplen kostar 30 kr. Om grafen visar proportionalitet, vad kostar <strong>7 kg</strong> √§pplen?
                            </p>
                            <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                                <input type="number" id="challenge-input" placeholder="?" style="padding: 10px 15px; font-size: 16px; border: 2px solid #ddd; border-radius: 10px; width: 100px; text-align: center;">
                                <span>kr</span>
                                <button onclick="checkChallenge()" style="background: #5d4037; color: white; border: none; padding: 10px 20px; border-radius: 20px; font-family: Verdana; font-size: 14px; cursor: pointer;">Kolla</button>
                            </div>
                            <p id="challenge-feedback" style="margin-top: 10px; display: none;"></p>
                        </div>
                    </div>

                    <a href="uppgift-06-kombinera-klader.html" class="next-btn" style="margin-top: 20px;">N√§sta uppgift ‚Üí</a>
                </div>
            </div>
        </main>
    </div>

    <button class="pause-button" id="pause-btn" onclick="showPause()">üßò Jag beh√∂ver en paus</button>

    <div class="pause-modal" id="pause-modal">
        <div class="pause-content">
            <h2 id="pause-title">Paus! üåü</h2>
            <p id="pause-message">Bra att du tar en paus!</p>
            <button class="pause-close" onclick="hidePause()">Jag √§r redo igen ‚Üí</button>
        </div>
    </div>

    <script>
        const TASK_NUMBER = 5;
        const STORAGE_PREFIX = 'esther-kap3';
        const pageStartTime = Date.now();
        let hintTimes = [];
        let userAnswers = [];
        let attempts = 0;
        let currentHint = 0;
        const totalHints = 3;

        function saveTracking(wasCompleted, wasSkipped) {
            try {
                let trackingData = JSON.parse(localStorage.getItem(STORAGE_PREFIX + '-tracking') || '[]');
                const existingIndex = trackingData.findIndex(t => t.task === TASK_NUMBER);
                const data = {
                    task: TASK_NUMBER,
                    timeOnPage: Date.now() - pageStartTime,
                    hintsUsed: currentHint,
                    hintTimes: hintTimes,
                    wasSkipped: wasSkipped,
                    attempts: attempts,
                    answers: userAnswers,
                    completedAt: wasCompleted ? new Date().toISOString() : null,
                    timestamp: new Date().toISOString()
                };
                if (existingIndex > -1) {
                    trackingData[existingIndex] = data;
                } else {
                    trackingData.push(data);
                }
                localStorage.setItem(STORAGE_PREFIX + '-tracking', JSON.stringify(trackingData));
            } catch(e) {}
        }

        function showNextHint() {
            hintTimes.push(Date.now() - pageStartTime);
            const hintSection = document.getElementById('hint-section');
            const hintButton = document.querySelector('.hint-button');

            if (!hintSection.classList.contains('show')) {
                hintSection.classList.add('show');
            }

            currentHint++;

            if (currentHint <= totalHints) {
                document.getElementById('hint-' + currentHint).classList.add('show');
                document.getElementById('dot-' + currentHint).classList.add('active');

                if (currentHint < totalHints) {
                    hintButton.innerHTML = 'üí° N√§sta ledtr√•d (' + currentHint + '/' + totalHints + ')';
                } else {
                    hintButton.innerHTML = 'üí° Alla ledtr√•dar visade';
                    hintButton.disabled = true;
                }
            }
        }

        function checkAnswer(button, isCorrect) {
            const feedback = document.getElementById('feedback');
            const success = document.getElementById('success');
            const allButtons = document.querySelectorAll('.answer-btn');

            userAnswers.push(button.dataset.answer);
            attempts++;

            allButtons.forEach(btn => btn.disabled = true);

            if (isCorrect) {
                button.classList.add('correct');
                feedback.textContent = 'Perfekt! Graf A √§r rak och g√•r genom origo - det √§r proportionalitet!';
                feedback.className = 'feedback show correct';

                setTimeout(() => {
                    success.classList.add('show');
                    markCompleted(TASK_NUMBER);
                    saveTracking(true, false);
                }, 1000);
            } else {
                button.classList.add('incorrect');

                if (button.dataset.answer === 'B') {
                    feedback.textContent = 'Graf B √§r en kurva, inte en rak linje. F√∂rs√∂k igen!';
                } else {
                    feedback.textContent = 'Graf C √§r rak men startar inte i origo. F√∂rs√∂k igen!';
                }
                feedback.className = 'feedback show incorrect';

                setTimeout(() => {
                    allButtons.forEach(btn => {
                        if (!btn.classList.contains('incorrect')) {
                            btn.disabled = false;
                        }
                    });
                }, 1500);
            }
        }

        function skipTask() {
            markSkipped(TASK_NUMBER);
            saveTracking(false, true);
            window.location.href = 'uppgift-06-kombinera-klader.html';
        }

        function markCompleted(taskNumber) {
            let completed = [];
            try {
                completed = JSON.parse(localStorage.getItem(STORAGE_PREFIX + '-completed-tasks') || '[]');
            } catch(e) {}
            if (!completed.includes(taskNumber)) {
                completed.push(taskNumber);
                localStorage.setItem(STORAGE_PREFIX + '-completed-tasks', JSON.stringify(completed));
            }
            let skipped = [];
            try {
                skipped = JSON.parse(localStorage.getItem(STORAGE_PREFIX + '-skipped-tasks') || '[]');
            } catch(e) {}
            const idx = skipped.indexOf(taskNumber);
            if (idx > -1) {
                skipped.splice(idx, 1);
                localStorage.setItem(STORAGE_PREFIX + '-skipped-tasks', JSON.stringify(skipped));
            }
        }

        function markSkipped(taskNumber) {
            let completed = [];
            try {
                completed = JSON.parse(localStorage.getItem(STORAGE_PREFIX + '-completed-tasks') || '[]');
            } catch(e) {}
            if (completed.includes(taskNumber)) return;
            let skipped = [];
            try {
                skipped = JSON.parse(localStorage.getItem(STORAGE_PREFIX + '-skipped-tasks') || '[]');
            } catch(e) {}
            if (!skipped.includes(taskNumber)) {
                skipped.push(taskNumber);
                localStorage.setItem(STORAGE_PREFIX + '-skipped-tasks', JSON.stringify(skipped));
            }
        }

        (function updateNav() {
            try {
                const completed = JSON.parse(localStorage.getItem(STORAGE_PREFIX + '-completed-tasks') || '[]');
                if (completed.includes(3)) document.getElementById('nav-3').classList.add('completed');
                if (completed.includes(4)) document.getElementById('nav-4').classList.add('completed');
            } catch(e) {}
        })();

        window.addEventListener('beforeunload', function() {
            const success = document.getElementById('success');
            if (!success.classList.contains('show')) {
                saveTracking(false, false);
            }
        });

        const pauseButtons = [
            { btn: "üßò Ta en paus", title: "Paus! üåü", msg: "Bra att du tar en paus! Sitt kvar och slappna av." },
            { btn: "üí™ Str√§ck p√• armarna", title: "Str√§ck ut! üí™", msg: "Str√§ck armarna h√∂gt √∂ver huvudet och h√•ll i 5 sekunder!" },
            { btn: "üôÜ Rulla axlarna", title: "Rulla axlarna! üôÜ", msg: "Rulla axlarna bak√•t 5 g√•nger, sedan fram√•t 5 g√•nger." },
            { btn: "üëÄ Vila √∂gonen", title: "Vila √∂gonen! üëÄ", msg: "Titta bort fr√•n sk√§rmen och fokusera p√• n√•got l√•ngt bort i 20 sekunder." },
            { btn: "üå¨Ô∏è Andas djupt", title: "Andas! üå¨Ô∏è", msg: "Ta 3 djupa andetag - in genom n√§san, ut genom munnen." },
            { btn: "ü§∏ Vrid p√• kroppen", title: "Vrid! ü§∏", msg: "Sitt kvar och vrid f√∂rsiktigt √∂verkroppen √•t h√∂ger, sedan √•t v√§nster." },
            { btn: "‚úã Skaka h√§nderna", title: "Skaka loss! ‚úã", msg: "Skaka h√§nderna snabbt i 10 sekunder f√∂r att f√• ig√•ng blodet!" },
            { btn: "üòä Le stort", title: "Le! üòä", msg: "Le s√• stort du kan och h√•ll i 5 sekunder. Det g√∂r dig gladare!" },
            { btn: "ü¶í Str√§ck p√• nacken", title: "Str√§ck nacken! ü¶í", msg: "Luta huvudet f√∂rsiktigt √•t h√∂ger, h√•ll i 5 sekunder, sedan √•t v√§nster." },
            { btn: "üëä Knyt h√§nderna", title: "Knyt och sl√§pp! üëä", msg: "Knyt h√§nderna h√•rt, h√•ll i 3 sekunder, sl√§pp. Upprepa 3 g√•nger." }
        ];

        function getRandomPause() {
            return pauseButtons[Math.floor(Math.random() * pauseButtons.length)];
        }

        function showPause() {
            const pause = getRandomPause();
            document.getElementById('pause-title').textContent = pause.title;
            document.getElementById('pause-message').textContent = pause.msg;
            document.getElementById('pause-modal').classList.add('active');
        }

        function hidePause() {
            document.getElementById('pause-modal').classList.remove('active');
        }

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') hidePause();
        });

        // Utmaning-funktioner
        function toggleChallenge() {
            const content = document.getElementById('challenge-content');
            const arrow = document.getElementById('challenge-arrow');
            if (content.style.display === 'none') {
                content.style.display = 'block';
                arrow.textContent = '‚ñ≤';
            } else {
                content.style.display = 'none';
                arrow.textContent = '‚ñº';
            }
        }

        function checkChallenge() {
            const input = document.getElementById('challenge-input');
            const feedback = document.getElementById('challenge-feedback');
            const answer = parseInt(input.value);
            // 2 kg = 30 kr, s√• 1 kg = 15 kr, 7 kg = 105 kr
            if (answer === 105) {
                feedback.textContent = 'üåü Fantastiskt! 1 kg = 15 kr, s√• 7 kg = 7 √ó 15 = 105 kr!';
                feedback.style.color = '#4a7a5a';
                feedback.style.background = '#e1f8e8';
            } else {
                feedback.textContent = 'Inte riktigt. Tips: Om 2 kg = 30 kr, vad kostar 1 kg?';
                feedback.style.color = '#7a4a4a';
                feedback.style.background = '#f8e8e8';
            }
            feedback.style.display = 'block';
            feedback.style.padding = '10px';
            feedback.style.borderRadius = '8px';
        }
    </script>
</body>
</html>
